/*! @version 1.0.7 */
define(["jquery","encrypt"],function(e,a){var i,s={SUCC:0},c={HTML:"html",JSON:"json",TEXT:"text"},p=6e4,l=function(e,t){var n,r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||o.length,e)for(n=0;n<e;n++)a[n]=o[0|Math.random()*t];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",n=0;n<36;n++)a[n]||(r=0|16*Math.random(),a[n]=o[19==n?3&r|8:r]);return a.join("")},o=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,u=function(e,t,n,r){return"function"==typeof e&&(r=n,n=t,t=e,e=""),{cmd:e,callback:t,sync:!!n,encrypt:!!r}},f=function(e,t){return $.extend({encrypt:!1,timeout:p,dataType:c.JSON,beforeSend:function(e){e.overrideMimeType("text/plain; charset=utf-8")},headers:{_log4xContextKey:l(22,16)}},e||{},{async:!0},t||{})},d=function(e,t){var n,r,o;return t=a.enc.Latin1.parse((n=16,r=" ",o=t,(o=Array(n+1).join(r)+o).slice(-n))),a.AES.encrypt(e,t,{iv:t,mode:a.mode.CBC,padding:a.pad.ZeroPadding}).toString()},y=function(e,t){if("string"==typeof t&&"object"==typeof e){var n,r=t.match(/[?|&]uid=([^&]+)/);if(r)n=r[1];else/^http/.test(t)||(t=v(t)),n=t.replace(/(https?:\/\/[^\/]+\/)|(\/)/,"").split("?")[0].slice(0,16);for(var o in e)value=e[o]+"",e[o]=d(value,n)}return e},v=function(e){var t=window.location.pathname.split("/"),n=e.split("/");if(""===n[0])return e;var r,o=1,a=[];for(var c in n){var u=n[c];".."==u?o++:"."==u||a.push(u)}return r=t.slice(0,t.length-o),[].concat(r,a).join("/")},h=function(e,t,n,r,o){var a={XMLHttpRequest:n,textStatus:t,errorThrown:r};if(i&&i[e.returnCode])i[e.returnCode](e,t,n);else if("BUSIOPER=RELOGIN"!=e.returnCode){var c=e.returnCode==s.SUCC;if(!o){var u=$.Deferred();return c?u.resolve(e,a):u.reject(e,a)}o(e,c,a)}else window.location.href="../../login.html"},m=function(e,t,n,r){var o={returnCode:"404",returnMessage:"网络异常或超时，请稍候再试！"},a={XMLHttpRequest:e,textStatus:t,errorThrown:n};if(!r)return $.Deferred().reject(o,a);r(o,!1,a)},T=function(e,t,r){var n="html"==r.dataType;r.encrypt&&t&&(t=y(t,e));var o=$.extend({url:e,data:t,cache:n},r);return $.ajax(o).then(function(e,t,n){if(e)return r.nativeAjax?function(e,t,n,r,o){var a={XMLHttpRequest:n,textStatus:t,errorThrown:r};if(i&&i[e.returnCode])i[e.returnCode](e,t,n);else{if("BUSIOPER=RELOGIN"!=e.returnCode)return o?void o(e,isSuc,a):$.Deferred().resolve(e,a);window.location.href="../../login.html"}}(e,t,n):h(e,t,n)},function(e,t,n){return m(e,t,n)})},j=function(e,t,n,r,o,a,c){var u="html"==r;return c&&(n=y(n,e)),$.ajax({url:e,type:t,data:n,headers:{_log4xContextKey:l(22,16)},cache:u,dataType:r,async:!a,timeout:p,beforeSend:function(e){e.overrideMimeType("text/plain; charset=utf-8")},success:function(e,t,n){e&&("html"==r&&o?o(e,!0):h(e,t,n,null,o))},error:function(e,t,n){m(e,t,n,o)}})};return{codeHandle:function(e){i=e},getJson:function(e,t,n,r,o){var a=u(t,n,r,o);j(e,"GET",a.cmd,c.JSON,a.callback,a.sync,a.encrypt)},postJson:function(e,t,n,r,o){var a=u(t,n,r,o);j(e,"POST",a.cmd,c.JSON,a.callback,a.sync,a.encrypt)},putJson:function(e,t,n,r,o){var a=u(t,n,r,o);j(e,"PUT",a.cmd,c.JSON,a.callback,a.sync,a.encrypt)},deleteJson:function(e,t,n,r,o){var a=u(t,n,r,o);j(e,"DELETE",a.cmd,c.JSON,a.callback,a.sync,a.encrypt)},getJsonp:function(e,t,n,r){var o,a,c,u,i;a="GET",c=t,u=n,i=r,(o=e)&&""!==o?u&&""!==u?(c&&""!==c||console.log("warn! your passed null or empty to cmd param, are you suer?"),$.ajax({url:o,type:a,data:c,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",async:!i,timeout:p,beforeSend:function(e){e.overrideMimeType("text/plain; charset=utf-8")},success:function(e,t,n){e&&h(e,t,n,null,u)},error:function(e,t,n){m(e,t,n,u)}})):console.log("you missed callback, it must be a function"):console.log("the url of param cann't equals null or empty of string")},ajax:function(e){var t=$.extend({type:"post",dataType:"json",timeout:3e4,beforeSend:function(e){e.overrideMimeType("text/plain; charset=utf-8")}},e);return $.ajax(t)},getJsonAsync:function(e,t,n){var r=f(n,{type:"GET"});return T(e,t,r)},postJsonAsync:function(e,t,n){var r=f(n,{type:"POST"});return T(e,t,r)},putJsonAsync:function(e,t,n){var r=f(n,{type:"PUT"});return T(e,t,r)},deleteJsonAsync:function(e,t,n){var r=f(n,{type:"DELETE"});return T(e,t,r)},corsAsync:this.cors,corsNative:function(e,t,n){"object"==typeof e&&(e=(n=e).url,t=n.data),n=$.extend({url:e,data:t},n),$.support&&($.support.cors=!0),o&&(n.xhrFields={withCredentials:!0});var r=f(n,{crossDomain:!0,headers:n&&n.headers||{},contentType:"application/json; charset=utf-8"});return r.type||(r.type="post"),r.nativeAjax=!0,T(e,t,r)},cors:function(e,t,n){"object"==typeof e&&(e=(n=e).url,t=n.data),$.support&&($.support.cors=!0);var r=f(n,{crossDomain:!0,headers:n&&n.headers||{},contentType:"application/json; charset=utf-8"});return r.type||(r.type="post"),T(e,t,r)}}});